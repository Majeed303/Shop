<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <link href="/images/favicon.png" rel="icon">
  <title>Eiser ecommerce</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="css/bootstrap.css" />
  <link rel="stylesheet" href="vendors/linericon/style.css" />
  <link rel="stylesheet" href="css/font-awesome.min.css" />
  <link rel="stylesheet" href="css/themify-icons.css" />
  <link rel="stylesheet" href="vendors/owl-carousel/owl.carousel.min.css" />
  <link rel="stylesheet" href="vendors/lightbox/simpleLightbox.css" />
  <link rel="stylesheet" href="vendors/nice-select/css/nice-select.css" />
  <link rel="stylesheet" href="vendors/animate-css/animate.css" />
  <link rel="stylesheet" href="vendors/jquery-ui/jquery-ui.css" />

  
  <!-- main css -->
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/responsive.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <style>
    html {
  scroll-behavior: smooth;
  scroll-behavior: 500ms; /* scroll speed in milliseconds */
}

  </style>

</head>

<body>
  <!--================Header Menu Area =================-->

  <!--================Header Menu Area =================-->

  <!--================Home Banner Area =================-->
  <section class="banner_area">
    <div class="banner_inner d-flex align-items-center">
      <div class="container">
        <div class="banner_content d-md-flex justify-content-between align-items-center">
          <div class="mb-3 mb-md-0">
            <h2>Product Checkout</h2>
            <p>Very us move be blessed multiply night</p>
          </div>
          <div class="page_link">
            <a href="index.html">Home</a>
            <a href="checkout.html">Product Checkout</a>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!--================End Home Banner Area =================-->

  <!--================Checkout Area =================-->
  <section class="checkout_area section_gap">
    <div class="container">
      <div class="billing_details">
        <div class="row">
          <div class="col-lg-8">

            <div class="cupon_area">
              <div class="check_title">

                <h2>
                  Have a coupon?
                  <a href="#coupon-code">Click here to enter your code</a>
                </h2>

              </div>
              <input style="width: 80%;" type="text" placeholder="Enter coupon code" id="coupon-code" /> 
              <div id="coupon" style="color: red; padding-bottom: 1rem; font-weight: 900; padding-left: 2rem; font-size: smaller;"></div> 
              <a class="tp_btn" id="apply-coupon-btn">Apply Coupon</a>
            </div>
            

            <h3>Billing Details</h3>

            <!--================form Area =================-->
            <form id="checkout-form" class="row contact_form" action="" method="post" novalidate="novalidate">
              <% if (address.length > 0) { %>
              <% address.forEach((addr) => { %>
              

                <div class="col-md-6 form-group p_star">
                  <input type="text" class="form-control" id="name" name="name1" placeholder="First Name" value=" <%= addr.deliverydetails.firstname%>" required="" />
                </div>
  
  
                <div class="col-md-6 form-group p_star">
                  <input type="text" class="form-control" id="sname" name="name2" placeholder="Last Name" value=" <%= addr.deliverydetails.secondname%>" required />
  
                </div>
  
  
                <div class="col-md-12 form-group">
                  <input style="height: 50px;" type="text" class="form-control" id="adresss" name="adress" value="<%= addr.deliverydetails.adress%>" required/>
                </div>
  
                <div class="col-md-6 form-group p_star">
                  <input type="number" class="form-control" id="number" name="number"   value="<%= addr.deliverydetails.number%>" required  />
                </div>
  
  
                <div class="col-md-6 form-group p_star">
                  <input type="email" class="form-control" id="email" name="email"  value="<%= addr.deliverydetails.email%> " required/>
  
                </div>
  
                <div class="col-md-6 form-group p_star">
                  <input type="text" class="form-control" id="city" name="city"   value="<%= addr.deliverydetails.city%>" required/>
                </div>

                
            
            <input type="text" name="userid" id="" value="<%= user._id %>" hidden>
            <input type="text" name="total" id="not-gegtgt"  value="<%= total %>" hidden>
            <% }) %>
                <%   }else{  %>

                  <div class="col-md-6 form-group p_star">
                    <input  type="text" class="form-control" id="name" name="name1" placeholder="First Name" required />
                  </div>
    
    
                  <div class="col-md-6 form-group p_star">
                    <input type="text" class="form-control" id="sname" name="name2" placeholder="Last Name" required/>
    
                  </div>
    
    
                  <div class="col-md-12 form-group">
                    <input style="height: 50px;" type="text" class="form-control" id="adresss" name="adress"
                      placeholder="Address" required />
                  </div>
    
                  <div class="col-md-6 form-group p_star">
                    <input type="number" class="form-control" id="number" name="number" placeholder="Phone number" required />
                  </div>
    
    
                  <div class="col-md-6 form-group p_star">
                    <input type="email" class="form-control" id="email" name="email" placeholder="Email Address" required />
    
                  </div>
    
                  <div class="col-md-6 form-group p_star">
                    <input type="text" class="form-control" id="city" name="city" placeholder="Town/City" required />
                  </div>

                  

              
              <input type="text" name="userid" id="" value="<%= user._id %>" hidden>
              <input type="text" name="total" id="cvvccv"  value="<%= total %>" hidden>

              <%  }  %>             
              

                  

              <!--================End form Area =================-->
          </div>

          <div class="col-lg-4">
            <div class="order_box">

              <h2>Your Order</h2>

                <ul class="list">
                  <li>
  
              </li>
            </ul>
              <hr>


              <ul class="list">
                <li>
                  <a href="">Product
                    <span>Total</span>
                  </a>
                </li>
              </ul>

              <ul class="list list_2">
                <li>
                  <a href="#">Subtotal
                    <span>$<%= total %></span></span>
                  </a>
                </li>
                <li>
                  <a href="#">Shipping
                    <span> $0</span>
                  </a>
                </li>
                <li>
                  <li>
                    <a href="#">You saved
                      <span> $0</span>
                    </a>
                  </li>
                  <li>
                  <a href="#">TOTAL
                    <span id="total-price">$<%= total %></span>
                  </a>
                </li>
              </ul>

              <div class="payment_item">
                <div class="radion_btn">
                  <input type="radio" id="f-option5" name="payment-method" value="COD" />
                  <label for="f-option5">Cash on delivery</label>
                  <div class="check"></div>
                </div>
                <p>
                   Type of transaction where the recipient pays for a good at the time of delivery rather than using credit.
                </p>
              </div>


              <div class="payment_item active">
                <div class="radion_btn">
                  <input type="radio" id="f-option6" name="payment-method" value="paypal" />
                  <label for="f-option6">Paypal </label>

                  <div class="check"></div>
                </div>


                <p>
                  Online ordering systems operate similarly to an online takeaway. Your customer orders online, completes their payment .
                </p>
                <div id="message" style="color: red; padding-bottom: 1rem; font-weight: 900; padding-left: 1rem;"></div>
                <div id="message" style="color: red; padding-bottom: 1rem; font-weight: 900; padding-left: 1rem;"></div>
                <button class="btn btn-success float-right mt-5" type="submit">Procced</button>
              </div>
            </div>
          </div>
          </form>
        </div>
      </div>
    </div>
  </section>
  <!--================End Checkout Area =================-->

  <div class="modal fade" id="confirm-modal" tabindex="-1" aria-labelledby="confirm-modal-label" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirm-modal-label">Conform order</h5>

        </div>
        <div class="modal-body">
          <p>Are you sure the order</p>
        </div>

        <div class="modal-footer">
          <a href="" class="btn btn-secondary">Cancel</a>
          <button type="button" class="btn btn-danger" id="remove-fav-btn">Ok</button>
        </div>
      </div>
    </div>
  </div>

  <!--================ start footer Area  =================-->


  <footer class="footer-area section_gap">
    <div class="container">
      <div class="row">
        <div class="col-lg-2 col-md-6 single-footer-widget">
          <h4>Top Products</h4>
          <ul>
            <li><a href="#">Managed Website</a></li>
            <li><a href="#">Manage Reputation</a></li>
            <li><a href="#">Power Tools</a></li>
            <li><a href="#">Marketing Service</a></li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-6 single-footer-widget">
          <h4>Quick Links</h4>
          <ul>
            <li><a href="#">Jobs</a></li>
            <li><a href="#">Brand Assets</a></li>
            <li><a href="#">Investor Relations</a></li>
            <li><a href="#">Terms of Service</a></li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-6 single-footer-widget">
          <h4>Features</h4>
          <ul>
            <li><a href="#">Jobs</a></li>
            <li><a href="#">Brand Assets</a></li>
            <li><a href="#">Investor Relations</a></li>
            <li><a href="#">Terms of Service</a></li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-6 single-footer-widget">
          <h4>Resources</h4>
          <ul>
            <li><a href="#">Guides</a></li>
            <li><a href="#">Research</a></li>
            <li><a href="#">Experts</a></li>
            <li><a href="#">Agencies</a></li>
          </ul>
        </div>
        <div class="col-lg-4 col-md-6 single-footer-widget">
          <h4>Newsletter</h4>
          <p>You can trust us. we only send promo offers,</p>
          <div class="form-wrap" id="mc_embed_signup">
            <form target="_blank"
              action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
              method="get" class="form-inline">
              <input class="form-control" name="EMAIL" placeholder="Your Email Address" onfocus="this.placeholder = ''"
                onblur="this.placeholder = 'Your Email Address '" required="" type="email">
              <button class="click-btn btn btn-default">Subscribe</button>
              <div style="position: absolute; left: -5000px;">
                <input name="b_36c4fd991d266f23781ded980_aefe40901a" tabindex="-1" value="" type="text">
              </div>

              <div class="info"></div>
            </form>
          </div>
        </div>
      </div>
      <div class="footer-bottom row align-items-center">
        <p class="footer-text m-0 col-lg-8 col-md-12">
          <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          Copyright &copy;
          <script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i
            class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
          <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
        </p>
        <div class="col-lg-4 col-md-12 footer-social">
          <a href="#"><i class="fa fa-facebook"></i></a>
          <a href="#"><i class="fa fa-twitter"></i></a>
          <a href="#"><i class="fa fa-dribbble"></i></a>
          <a href="#"><i class="fa fa-behance"></i></a>
        </div>
      </div>
    </div>
  </footer>
  <!--================ End footer Area  =================-->

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>

    
    $("#checkout-form").submit((e) => {
      e.preventDefault();
      if (
        $("#name").val() === "" ||
        $("#sname").val() === "" ||
        $("#address").val() === "" ||
        $("#number").val() === "" ||
        $("#email").val() === "" ||
        $("#city").val() === "" ||
        $("#email").val() === ""
      ) {
        var messageElem = document.getElementById("message");
        messageElem.innerHTML = "Pls fill the fome.";
        setTimeout(function () {
          messageElem.innerHTML = "";
        }, 3000);
        return;
      }

      if ($('input[name="payment-method"]:checked').length === 0) {
        var messageElem = document.getElementById("message");
        messageElem.innerHTML = "Select a payment method.";
        setTimeout(function () {
          messageElem.innerHTML = "";
        }, 3000);
        return;
      }

      var confirmModal = $("#confirm-modal");
      var removeButton = $("#remove-fav-btn");
      removeButton.off("click"); // remove any previous click event handlers
      removeButton.on("click", function () {
        $.ajax({
          url: "/placeorder",
          method: "post",
          data: $("#checkout-form").serialize(),
          success: (response) => {
            if (response.result) {
              window.history.replaceState(null, null, "/ordersuccess");
              location.href = "/ordersucess";
            } else {
              razoypaypayment(response)
            }
          },
        });
        confirmModal.modal("hide");
      });
      confirmModal.modal("show");
    });

    function razoypaypayment(order) {
      var options = {
        "key": "rzp_test_JFBRQBvO53Jitx", // Enter the Key ID generated from the Dashboard
        "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        "currency": "INR",
        "name": "crossroads", //your business name
        "description": "Test Transaction",
        "image": "https://example.com/your_logo",
        "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
        "handler": function (response) {
          verifypayment(response, order)
        },
        "prefill": {
          "name": "Gaurav Kumar", //your customer's name
          "email": "gaurav.kumar@example.com",
          "contact": "9000090000"
        },
        "notes": {
          "address": "Razorpay Corporate Office"
        },
        "theme": {
          "color": "#3399cc"
        }
      };
      var rzp1 = new Razorpay(options);
      rzp1.open();
    }

    function verifypayment(payment,order) {
      $.ajax({
        url: "/verifypayment",
        data: {
          payment,
          order
        },
        method: 'post',
        success: (response) => {

          if (response.status) {

            window.history.replaceState(null, null, "/ordersuccess");
            location.href = "/ordersucess";
            $.ajax({
                    url: "/",
                    method: "get",
                    success: (homepageData) => {
                        let count = $(homepageData).find("#cart-count").html();
                        console.log("Current count:", count);
                        count = parseInt(count) = 0;
                        $("#cart-count").html(count);
                    }
                });

          } else {
           
          }
        }
      })
    }

       $(document).ready(function() {
      $('#apply-coupon-btn').on('click', function() {
      var couponCode = $('#coupon-code').val();
      $.ajax({
      type: 'POST',
      url: '/couponcode',
      data:
       {couponCode: couponCode},
      success: function(response) {

        if(response.status){

         // Update the total price element using innerHTML
      var totalPriceElem = document.getElementById("total-price");
      totalPriceElem.innerHTML = response.totalprice;

      var totalPriceEleme = document.getElementById("not-gegtgt");
      if (totalPriceEleme) {
      totalPriceEleme.value = response.totalprice;
     } else {
     console.log("Error: element with ID 'not-gegtgt' not found.");
    }

      // Update the hidden input field value using value property
      var totalPriceEleme = document.getElementById("cvvccv");
      totalPriceEleme.value = response.totalprice;
       
      console.log(response.totalprice);
      // Update the third element's value using the value property
      var totalPriceEleme  = document.getElementById("not-gegtgt");
      totalPriceEleme.value = response.totalprice;

      // Display a success message to the user
      var messageElem = document.getElementById("coupon");
      messageElem.innerHTML = "Your Code Was  Entered Successfully,enjoy!";
      setTimeout(function() {
        messageElem.innerHTML = "";
      }, 5000);
          
        }else{
          var messageElem = document.getElementById("coupon");
               messageElem.innerHTML = response.message ;
              setTimeout(function () {
                messageElem.innerHTML = "";
                 }, 5000);
                   return;  
        }
      },
      error: function(xhr, textStatus, errorThrown) {
        // Handle any errors here
        console.log('Error: ' + errorThrown);
      }
    });
  });
});


  </script>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="/js/vw/jquery-3.2.1.min.js"></script>
  <script src="/js/vw/popper.js"></script>
  <script src="/js/vw/bootstrap.min.js"></script>
  <script src="/js/vw/stellar.js"></script>
  <script src="vendors/lightbox/simpleLightbox.min.js"></script>
  <script src="vendors/nice-select/js/jquery.nice-select.min.js"></script>
  <script src="vendors/isotope/imagesloaded.pkgd.min.js"></script>
  <script src="vendors/isotope/isotope-min.js"></script>
  <script src="vendors/owl-carousel/owl.carousel.min.js"></script>
  <script src="/js/vw/jquery.ajaxchimp.min.js"></script>
  <script src="/js/vw/mail-script.js"></script>
  <script src="vendors/jquery-ui/jquery-ui.js"></script>
  <script src="vendors/counter-up/jquery.waypoints.min.js"></script>
  <script src="vendors/counter-up/jquery.counterup.js"></script>
  <script src="/js/vw/theme.js"></script>
</body>

</html>